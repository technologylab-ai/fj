<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Travel Expenses â€” fj</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Configure Tailwind to use Inter font and extend default theme if needed -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Custom styles for specific overrides, especially for responsive tables -->
  <style>
    /* Ensure Inter font is loaded for better appearance */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    /* Specific style for fj_home, not directly covered by Tailwind */
    .fj_home {
        display: inline-block;
        unicode-bidi: embed;
        font-family: monospace;
        white-space: pre;
    }

    /* Custom CSS to ensure text wraps and columns shrink on smaller screens for tables */
    @media (max-width: 767px) {
      .travel-table td, .travel-table th {
        white-space: normal; /* Allow text to wrap within cells */
        padding-left: 0.5rem; /* px-2 */
        padding-right: 0.5rem; /* px-2 */
      }
      /* Adjust action button size in table cells for small screens */
      .travel-table td button {
        font-size: 0.75rem; /* text-xs */
        padding: 0.25rem 0.5rem; /* py-1 px-2 */
      }
    }
  </style>
</head>
<body class="font-sans bg-gray-50 text-gray-800 min-h-screen flex flex-col">
  <!-- Header Section -->
  <header class="bg-white shadow-sm p-4 border-b border-gray-200">
    <div class="container mx-auto flex flex-col md:flex-row items-start md:items-center justify-between">
      <strong class="text-xl font-semibold text-gray-900 mb-2 md:mb-0">
                    {{company}}
      </strong>
      <nav class="flex flex-wrap gap-x-4 gap-y-2 text-sm md:text-base">
        <a href="/dashboard" class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200">Dashboard</a>
        <a href="/client" class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200">Clients</a>
        <a href="/rate" class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200">Rate Sets</a>
        <a href="/offer" class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200">Offers</a>
        <a href="/invoice" class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200">Invoices</a>
        <a href="/letter" class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200">Letters</a>
        <a href="/travel" class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200">Travel Expenses</a>
      </nav>
    </div>
  </header>

  <!-- Main Content Section -->
  <main class="container mx-auto p-4 flex-grow">
    <div class="w-full max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-xl border border-gray-200">
      <h1 class="text-3xl font-bold text-gray-900 mb-6 text-center">Travel Expenses</h1>

      <form id="travelExpenseForm" method="post" action="/travel-submit" enctype="multipart/form-data">
        <!-- About the Trip Section -->
        <section class="p-6 border border-gray-200 rounded-lg bg-gray-50 mb-6">
          <h2 class="text-xl font-semibold text-gray-800 pb-3 mb-4 border-b-2 border-gray-200">About the Trip</h2>

          <div class="mb-4">
            <label for="travelerName" class="block text-sm font-medium text-gray-700 mb-1">Travellee:</label>
            <input type="text" id="travelerName" name="travelerName" required
                   class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800" />
          </div>

          <div class="mb-4">
            <label for="travelDestination" class="block text-sm font-medium text-gray-700 mb-1">Destination:</label>
            <input type="text" id="travelDestination" name="travelDestination" placeholder="e.g., Berlin, Germany" required
                   class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800" />
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1">Travel Period:</label>
            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
              <div class="flex items-center gap-2 w-full sm:w-auto">
                <span class="text-gray-700 font-medium">from:</span>
                <input type="datetime-local" id="travelPeriodFrom" name="travelPeriodFrom" required
                       class="flex-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800" />
              </div>
              <div class="flex items-center gap-2 w-full sm:w-auto">
                <span class="text-gray-700 font-medium">to:</span>
                <input type="datetime-local" id="travelPeriodTo" name="travelPeriodTo" required
                       class="flex-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800" />
              </div>
            </div>
          </div>

          <div class="mb-4">
            <label for="travelPurpose" class="block text-sm font-medium text-gray-700 mb-1">Purpose of the trip:</label>
            <textarea id="travelPurpose" name="travelPurpose" rows="4" placeholder="Brief description of the travel purpose, e.g., client meetings, trade fair visit..." required
                      class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm resize-y min-h-[80px] text-gray-800"></textarea>
          </div>
          <div class="mb-4">
            <label for="travelComments" class="block text-sm font-medium text-gray-700 mb-1">Comments:</label>
            <textarea id="travelComments" name="travelComments" rows="4" placeholder="..." required
                      class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm resize-y min-h-[80px] text-gray-800"></textarea>
          </div>
        </section>

        <!-- Transport Section -->
        <section class="p-6 border border-gray-200 rounded-lg bg-gray-50 mb-6">
          <h2 class="text-xl font-semibold text-gray-800 pb-3 mb-4 border-b-2 border-gray-200">Transport</h2>

          <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-700 mb-3">Outbound Journey</h3>
            <div class="overflow-x-auto">
              <table id="outboundTravelTable" class="travel-table min-w-full divide-y divide-gray-200 table-fixed">
                <thead class="bg-gray-100">
                  <tr>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-1/3">Transport Method</th>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-1/2">Description</th>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-1/12"></th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <!-- Dynamic rows will be added here by JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="flex justify-start mt-4">
              <button type="button" class="add-row-button bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm cursor-pointer transition-colors duration-200" data-table="outboundTravelTable">
                + Add Transport
              </button>
            </div>
          </div>

          <div>
            <h3 class="text-lg font-semibold text-gray-700 mb-3">Return Journey</h3>
            <div class="overflow-x-auto">
              <table id="returnTravelTable" class="travel-table min-w-full divide-y divide-gray-200 table-fixed">
                <thead class="bg-gray-100">
                  <tr>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-1/3">Transport Method</th>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-1/2">Description</th>
                    <th scope="col" class="px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-1/12"></th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <!-- Dynamic rows will be added here by JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="flex justify-start mt-4">
              <button type="button" class="add-row-button bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm cursor-pointer transition-colors duration-200" data-table="returnTravelTable">
                + Add Transport
              </button>
            </div>
          </div>
        </section>

        <!-- Upload Receipts Section -->
        <section class="p-6 border border-gray-200 rounded-lg bg-gray-50 mb-6">
          <h2 class="text-xl font-semibold text-gray-800 pb-3 mb-4 border-b-2 border-gray-200">Upload Receipts</h2>
          <div id="receiptsList" class="space-y-4">
            <!-- Dynamic receipt items will be added here by JavaScript -->
          </div>
          <div class="flex justify-start mt-4">
            <button type="button" id="addReceiptButton" class="add-row-button bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm cursor-pointer transition-colors duration-200">
              + Add Receipt
            </button>
          </div>
        </section>

        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-md shadow-md cursor-pointer transition-colors duration-200 mt-8">
          Generate Documents
        </button>
      </form>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- Transportmittel-Tabellen-FunktionalitÃ¤t ---
      const addTravelRow = (tableId) => {
        const tableBody = document.getElementById(tableId).querySelector('tbody');
        const newRow = document.createElement('tr');
        // Use a more robust unique identifier if needed, or rely on backend to re-index
        const rowCount = tableBody.rows.length;

        // Apply Tailwind classes directly to the dynamically created elements
        newRow.innerHTML = `
          <td class="px-4 py-2 text-sm text-gray-800">
            <input type="text" name="${tableId}Type_${rowCount}" placeholder="e.g., Taxi, Plane, Train" required
                   class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800" />
          </td>
          <td class="px-4 py-2 text-sm text-gray-800">
            <input type="text" name="${tableId}Description_${rowCount}" placeholder="Description of the journey" required
                   class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800" />
          </td>
          <td class="px-4 py-2 text-sm text-gray-800">
            <button type="button" class="remove-row-button bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-2 rounded-md shadow-sm cursor-pointer transition-colors duration-200 text-xs">
              -
            </button>
          </td>
        `;
        tableBody.appendChild(newRow);

        // Event Listener for the new remove button
        newRow.querySelector('.remove-row-button').addEventListener('click', (event) => {
          event.target.closest('tr').remove();
          updateTravelRowNames(tableId); // Update names after removal
        });
      };

      // Helper function to update input names after removal (important for backend)
      const updateTravelRowNames = (tableId) => {
        const tableBody = document.getElementById(tableId).querySelector('tbody');
        Array.from(tableBody.rows).forEach((row, index) => {
          const typeInput = row.querySelector('input[name^="' + tableId + 'Type"]');
          if (typeInput) typeInput.name = `${tableId}Type_${index}`;
          const descInput = row.querySelector('input[name^="' + tableId + 'Description"]');
          if (descInput) descInput.name = `${tableId}Description_${index}`;
        });
      };

      // Event Listeners for "Add Transport" buttons
      document.querySelectorAll('.add-row-button[data-table]').forEach(button => {
        button.addEventListener('click', () => {
          addTravelRow(button.dataset.table);
        });
      });

      // Add an initial row for each table on page load
      addTravelRow('outboundTravelTable');
      addTravelRow('returnTravelTable');


      // --- Upload Receipts Functionality ---
      let receiptCounter = 0; // Counter for unique names

      const addReceiptField = () => {
        const receiptsList = document.getElementById('receiptsList');
        const newReceiptItem = document.createElement('div');
        // Apply Tailwind classes to the dynamically created elements
        newReceiptItem.classList.add('receipt-item', 'flex', 'flex-wrap', 'items-center', 'gap-4', 'p-3', 'border', 'border-gray-200', 'rounded-md', 'bg-white');

        // IMPORTANT: Adjust name attributes and add text field
        newReceiptItem.innerHTML = `
          <input type="file" name="receiptFile_${receiptCounter}" accept="image/*,.pdf" required
                 class="flex-grow min-w-[150px] text-gray-700 text-sm file:mr-4 file:py-2 file:px-4
                        file:rounded-md file:border-0 file:text-sm file:font-semibold
                        file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100
                        border border-gray-300 rounded-md shadow-sm cursor-pointer" />
          <input type="text" name="receiptName_${receiptCounter}" placeholder="File name (e.g., Outbound_Taxi)" required
                 class="flex-grow-[2] min-w-[180px] p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 shadow-sm text-gray-800" />
          <button type="button" class="remove-receipt-button bg-red-600 hover:bg-red-700 text-white font-semibold py-1 px-2 rounded-md shadow-sm cursor-pointer transition-colors duration-200 text-xs flex-shrink-0">
            -
          </button>
        `;
        receiptsList.appendChild(newReceiptItem);

        // Event Listener for the new remove button
        newReceiptItem.querySelector('.remove-receipt-button').addEventListener('click', (event) => {
          event.target.closest('.receipt-item').remove();
          // No index name update needed here as each pair remains unique
        });
        receiptCounter++; // Increment counter for the next field
      };

      // Event Listener for "Add Receipt" button
      document.getElementById('addReceiptButton').addEventListener('click', addReceiptField);

      // Add an initial field for receipts on page load
      addReceiptField();


      // --- Form Validation / Submission (optional, but recommended) ---
      const travelExpenseForm = document.getElementById('travelExpenseForm');
      travelExpenseForm.addEventListener('submit', (event) => {
        // You can add additional JavaScript validations here,
        // before the form is submitted to the backend.
        // e.g., check if at least one transport method has been entered.

        // Standard HTML5 validation (required attributes) runs automatically.
        // event.preventDefault(); // Needed if you implement custom validation to prevent default submission
      });
    });
  </script>
</body>
</html>

